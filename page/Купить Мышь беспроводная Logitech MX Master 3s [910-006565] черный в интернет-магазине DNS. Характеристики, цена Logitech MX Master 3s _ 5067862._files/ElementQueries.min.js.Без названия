"use strict";!function(e,t){"function"==typeof define&&define.amd?define(["./ResizeSensor.js"],t):"object"==typeof exports?module.exports=t(require("./ResizeSensor.js")):(e.ElementQueries=t(e.ResizeSensor),e.ElementQueries.listen())}("undefined"!=typeof window?window:this,function(e){var t=function(){var t,n={},i=[];function r(e){return e||(e=document.documentElement),parseFloat(window.getComputedStyle(e,null).fontSize)||16}function s(e,t){var n=t.split(/\d/),i=n[n.length-1];switch(t=parseFloat(t),i){case"px":default:return t;case"em":return t*r(e);case"rem":return t*r();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var s,o=document.documentElement.clientWidth/100;return t*(0,Math["vmin"===i?"min":"max"])(o,document.documentElement.clientHeight/100)}}function o(e,t){this.element=e;var i,r,o,l,a,u,d,m,c=["min-width","min-height","max-width","max-height"];this.call=function(){for(i in o=function e(t){if(!t.getBoundingClientRect)return{width:t.offsetWidth,height:t.offsetHeight};var n=t.getBoundingClientRect();return{width:Math.round(n.width),height:Math.round(n.height)}}(this.element),u={},n[t])n[t].hasOwnProperty(i)&&(r=n[t][i],l=s(this.element,r.value),a="width"===r.property?o.width:o.height,m=r.mode+"-"+r.property,d="","min"===r.mode&&a>=l&&(d+=r.value),"max"===r.mode&&a<=l&&(d+=r.value),u[m]||(u[m]=""),d&&-1===(" "+u[m]+" ").indexOf(" "+d+" ")&&(u[m]+=" "+d));for(var e in c)c.hasOwnProperty(e)&&(u[c[e]]?this.element.setAttribute(c[e],u[c[e]].substr(1)):this.element.removeAttribute(c[e]))}}function l(t,n){t.elementQueriesSetupInformation||(t.elementQueriesSetupInformation=new o(t,n)),t.elementQueriesSensor||(t.elementQueriesSensor=new e(t,function(){t.elementQueriesSetupInformation.call()}))}function a(e,r,s,o){if(void 0===n[e]){n[e]=[];var l=i.length;t.innerHTML+="\n"+e+" {animation: 0.1s element-queries;}",t.innerHTML+="\n"+e+" > .resize-sensor {min-width: "+l+"px;}",i.push(e)}n[e].push({mode:r,property:s,value:o})}function u(e){var t;if(document.querySelectorAll&&(t=e?e.querySelectorAll.bind(e):document.querySelectorAll.bind(document)),t||"undefined"==typeof $$||(t=$$),t||"undefined"==typeof jQuery||(t=jQuery),!t)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return t}function d(t){var n=[],i=[],r=[],s=0,o=-1,l=[];for(var a in t.children)if(t.children.hasOwnProperty(a)&&t.children[a].tagName&&"img"===t.children[a].tagName.toLowerCase()){n.push(t.children[a]);var u=t.children[a].getAttribute("min-width")||t.children[a].getAttribute("data-min-width"),d=t.children[a].getAttribute("data-src")||t.children[a].getAttribute("url");r.push(d);var m={minWidth:u};i.push(m),u?t.children[a].style.display="none":(s=n.length-1,t.children[a].style.display="block")}function c(){var e,a=!1;for(e in n)n.hasOwnProperty(e)&&i[e].minWidth&&t.offsetWidth>i[e].minWidth&&(a=e);if(a||(a=s),o!==a){if(l[a])n[o].style.display="none",n[a].style.display="block",o=a;else{var u=new Image;u.onload=function(){n[a].src=r[a],n[o].style.display="none",n[a].style.display="block",l[a]=!0,o=a},u.src=r[a]}}else n[a].src=r[a]}o=s,t.resizeSensorInstance=new e(t,c),c()}var m=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/mgi,c=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/mgi;function h(e){var t,n,i,r;for(e=e.replace(/'/g,'"');null!==(t=m.exec(e));)for(n=t[1]+t[3],i=t[2];null!==(r=c.exec(i));)a(n,r[1],r[2],r[3])}function f(e){var t="";if(e){if("string"==typeof e)(-1!==(e=e.toLowerCase()).indexOf("min-width")||-1!==e.indexOf("max-width"))&&h(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?h(t):(-1!==t.indexOf("min-width")||-1!==t.indexOf("max-width"))&&h(t):4===e[n].type?f(e[n].cssRules||e[n].rules):3===e[n].type&&e[n].styleSheet.hasOwnProperty("cssRules")&&f(e[n].styleSheet.cssRules)}}var p=!1;this.init=function(){var n="animationstart";void 0!==document.documentElement.style.webkitAnimationName?n="webkitAnimationStart":void 0!==document.documentElement.style.MozAnimationName?n="mozanimationstart":void 0!==document.documentElement.style.OAnimationName&&(n="oanimationstart"),document.body.addEventListener(n,function(t){var n=t.target,r=n&&window.getComputedStyle(n,null),s=r&&r.getPropertyValue("animation-name");if(s&&-1!==s.indexOf("element-queries")){n.elementQueriesSensor=new e(n,function(){n.elementQueriesSetupInformation&&n.elementQueriesSetupInformation.call()});var o=window.getComputedStyle(n.resizeSensor,null).getPropertyValue("min-width");o=parseInt(o.replace("px","")),l(t.target,i[o])}}),p||((t=document.createElement("style")).type="text/css",t.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img {width: 100%;}",t.innerHTML+="\n@keyframes element-queries { 0% { visibility: inherit; } }",document.getElementsByTagName("head")[0].appendChild(t),p=!0);for(var r=0,s=document.styleSheets.length;r<s;r++)try{document.styleSheets[r].href&&0===document.styleSheets[r].href.indexOf("file://")&&console.warn("CssElementQueries: unable to parse local css files, "+document.styleSheets[r].href),f(document.styleSheets[r].cssRules||document.styleSheets[r].rules||document.styleSheets[r].cssText)}catch(o){}!function e(){for(var t=u()("[data-responsive-image],[responsive-image]"),n=0,i=t.length;n<i;n++)d(t[n])}()},this.findElementQueriesElements=function(e){!function e(t){var i=u(t);for(var r in n)if(n.hasOwnProperty(r))for(var s=i(r,t),o=0,a=s.length;o<a;o++)l(s[o],r)}(e)},this.update=function(){this.init()}};t.update=function(){t.instance.update()},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor):e.resizeSensorInstance&&(e.resizeSensorInstance.detach(),delete e.resizeSensorInstance)},t.init=function(){t.instance||(t.instance=new t),t.instance.init()};var n=function(e){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))},10);else window.onload=e};return t.findElementQueriesElements=function(e){t.instance.findElementQueriesElements(e)},t.listen=function(){n(t.init)},t});
